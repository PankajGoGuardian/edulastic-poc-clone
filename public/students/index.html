<!DOCTYPE html>
<html>
  <head>
    <base href="/" />
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link
      rel="shortcut icon"
      type="image/png"
      href="//cdn.edulastic.com/JS/webresources/images/as/favicon.png"
    />
    <link
      rel="apple-touch-icon"
      type="image/png"
      href="//cdn.edulastic.com/JS/webresources/images/as/favicon.png"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Anton|Arimo|Fira+Sans|Lato|Lora|Merriweather|Montserrat|Muli|Nanum+Gothic|Noto+Sans|Noto+Sans+JP|Noto+Sans+KR|Noto+Serif|Nunito|Oswald|PT+Sans|PT+Sans+Narrow|PT+Serif|Playfair+Display|Poppins|Raleway|Roboto|Roboto+Condensed|Roboto+Mono|Roboto+Slab|Rubik|Slabo+27px|Titillium+Web|Ubuntu|Work+SansAlfa+Slab+One|Caveat|Dancing+Script|Great+Vibes|Kaushan+Script|Pacifico|Parisienne|Sacramento|Satisfy|Shadows+Into+Light&display=swap"
      rel="stylesheet"
    />
    <!-- adding for testing purpose -->
    <style>
      html,
      body {
        -webkit-text-size-adjust: none;
        touch-action: pan-x pan-y;
      }
    </style>
    <script>
      window.studentsApp = true
    </script>
    <title>Edulastic</title>
  </head>
  <script>
    /**
     * The event listener on load is used to replace
     * the Place holder(PUBLIC_URL_ORIGIN) href in
     * the stylesheet
     * and src in the JS scripts to a CDNURI derived.
     * For existing CDN URLs of no pattern is derived
     * from .env variables if exist
     * otherwise build pattern from origin
     */
    window.addEventListener('load', function () {
      const origin = new URL(window.origin)
      const protocol = origin.protocol
      const host = origin.host

      const customCDNKey = document
        .getElementById('custom-cdn-key')
        ?.getAttribute('data-cdn')
      const customCDNValue = document
        .getElementById('custom-cdn-value')
        ?.getAttribute('data-cdn')

      const cdnMap = { [customCDNKey]: customCDNValue }

      const subdomain = host.split('.')[0]
      const domain = host.split('.').slice(-2).join('.')
      const customCDNSubdomain = cdnMap[subdomain]

      let cdn = `${protocol}//cdn-${host}`
      if (customCDNSubdomain) {
        cdn = `${protocol}//${customCDNSubdomain}.${domain}`
      }

      // Update stylesheet links
      const linkElements = document.head.querySelectorAll(
        'link[rel="stylesheet"]'
      )
      linkElements.forEach((link) => {
        const href = link.href
        if (href.includes('PUBLIC_URL_ORIGIN')) {
          const filePath = link.attributes.href.nodeValue.replace(
            'PUBLIC_URL_ORIGIN',
            cdn
          )
          link.href = filePath
        }
      })

      // Update script sources
      const scriptElements = document.querySelectorAll('script[src]')
      scriptElements.forEach((script) => {
        const src = script.src
        if (src.includes('PUBLIC_URL_ORIGIN')) {
          const filePath = script.attributes.src.nodeValue.replace(
            'PUBLIC_URL_ORIGIN',
            cdn
          )
          script.src = filePath
        }
      })
    })
  </script>
  <body id="body">
    <section id="app-students"></section>
    <section id="modal-root"></section>
    <span id="custom-cdn-key" data-cdn="%REACT_APP_CUSTOM_CDN_KEY%"></span>
    <span id="custom-cdn-value" data-cdn="%REACT_APP_CUSTOM_CDN_VALUE%"></span>
  </body>
</html>
